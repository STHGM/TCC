%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CAPÍTULO 4
\chapter{METODOLOGIAS}

Neste capítulo, é explicado como as comparações foram feitas e o que foi retirado delas para a abordagem de resultados.

Uma pesquisa de campo foi realizada para saber mais dos tipos de colisões utilizadas através de um formulário que foi divulgado em grupos de comunidades de desenvolvedores de jogos de várias categorias (desenvolvedor independente, estudante, etc.).

Durante os testes foi usada a ferramenta \emph{Profiler} da \emph{Unity}. Essa ferramenta permite analisar em tempo real vários detalhes da performance do jogo em execução, como tempo em milissegundos, \emph{scripts} chamados, memória RAM utilizada, etc.

Para a obtenção dessas comparações foi usado um \emph{script} que grava os resultados em formato \emph{JSON}, criado por \citeauthor{DiPalma2017}(\citeyear{DiPalma2017}). Em seguida foram extraídos do arquivo apenas os dados que serão usados para essa análise comparativa, que serão detalhados mais a seguir. Após isso os arquivos foram convertidos para valores separados por vírgulas (\emph{CSVs}), para que pudessem ser lidos e manipulados por softwares de planilha.

Planilhas foram usadas para armazenar os resultados das pesquisas e dos testes onde podem ser exibidos em gráficos comparativos para melhor visualização e compreensão dos dados.

\section{Pesquisa de campo}

A pesquisa de campo foi criada usando o sistema de formulários da \emph{Google} (\emph{Google Forms}), em que é possível criar e visualizar os resultados em tempo real.

O formulário foi feito tanto em português, como em inglês e foi divulgado em grupos de comunidade de desenvolvedores.

O formulário é separado em quatro setores:

\begin{itemize}
	\item Quem é a pessoa respondendo
	
	Em que situação a pessoa se encontra na área de desenvolvimento de jogos. Se é um desenvolvedor independente, desenvolvedor de grande empresa (AAA), desenvolvedor por passatempo (\emph{hobby}) ou estudante.
	Isso ajuda a ter uma visão de quem usa e como usa tais tecnologias.
	
	\item Perguntas generalizadas sobre as cenas produzidas
	
	Uma cena ou nível em um jogo é onde a interação entre o jogador, o cenário e seus eventos acontece. Nela podem ter vários tipos de objetos de jogo, com diferentes propriedades, mas o foco nesse caso é em relação às colisões usadas nelas.
	
	As perguntas nessa seção consistem em saber qual o tipo de colisão predominante na maioria das cenas que produzem, que podem ser \emph{Static Collider}, \emph{Rigidbody Collider} e \emph{Kinematic Rigiddbody Collider}. E qual a média de objetos com a propriedade \emph{trigger} ligada usados em cada cena, que pode ter múltiplos valores atribuídos.
	
	\item Perguntas relacionadas à colisões 2D
	
	Quais os tipos de colisões mais utilizados em um cenário de jogo 2D, bem como as mensagens mais utilizadas para a manipulação de eventos e a média total de objetos com qualquer tipo de colisão em uma cena.
	
	Os tipos de colisões apresentadas no formulário são as mesmas apresentadas na subseção ~\ref{subsec:colliders2d}. E as mensagens apresentadas são as mesmas já explicadas na subseção ~\ref{subsec:mensagenscolliders}.
	
	\item Perguntas relacionadas à colisões 3D
	
	Segue exatamente o mesmo padrão do item anterior sobre colisões 2D, apenas alteradas para 3D. Feitas para ter uma visão á respeito do outro setor da \emph{Unity}.
	
	
\end{itemize}

Enquanto o formulário se encontra aberto para ser respondido, os resultados podem ser acompanhados em tempo real. O que permite ter uma visão desde o início dos resultados e como eles vão progredindo com o passar do tempo.

\section{\emph{Profiler} da \emph{Unity}}

\begin{figure}[!htb]
	\centering
	\includegraphics[width=1\textwidth]{./Figuras/profiler_unity_01.png}
	\caption[Profiler da Unity]{\emph{Profiler} da \emph{Unity}. Em verde, estão as categorias dos dados que são medidos. Em azul, o gráfico porcentual do uso das categorias. Em vermelho, as funções chamadas em dado quadro e seus respectivos dados de consumo.}
	\fonte{\cite{UnityTechnologies2017}}
	\label{profilerunity}
\end{figure}

\emph{Profiler} é uma ferramenta que permite a análise em tempo real dos dados e detalhes de uma cena durante sua execução.

Os dados coletados são divididos em vários setores, no entanto, apenas quatro atributos em uso de CPU são o foco deste projeto, que são porcentagem de uso total, chamadas, memória alocada pelo \emph{Garbage Collector} e tempo total em milissegundos(ms). O \emph{Profiler} permite também que os dados sejam coletados por métodos. Serão usados como coleta de dados os atributos já mencionados: \emph{Physics2D.Simulate}, as mensagens \emph{OnCollision2D} e \emph{OnTrigger2D}.

\emph{Physics2D.Simulate} é o método responsável por toda a simulação de física presente na cena, qualquer objeto estático, que tenha massa, corpo rígido ou \emph{trigger} é simulado por ele.

As mensagens de \emph{OnCollision2D} analisadas são as mesmas apresentadas na subseção~\ref{subsec:mensagenscolliders}. No mesmo padrão seguem as mensagens de \emph{OnTrigger2D} na subseção~\ref{subsec:mensagenstriggers}.

\begin{itemize}
	\item Porcentagem do uso total de CPU: Porcentagem do uso total de CPU de um método em. determinado quadro.
	
	\item Chamadas (\emph{Calls}): O número de vezes que o método foi chamado em determinado quadro.
	
	\item Memória alocada pelo \emph{Garbage Collector} (\emph{GCMemory}): A quantidade de memória alocada em \emph{bytes} no \emph{Garbage Collector} para a execução do método em determinado quadro.
	
	\item Tempo total em milissegundos (ms): A quantidade de tempo em milissegundos requerida para executar o método em determinado quadro.
	
\end{itemize}


\section{Obtenção e filtragem de dados}

Por padrão, o \emph{Profiler} da \emph{Unity}, não é capaz de salvar os dados coletados para visualização, comparação e manipulação em outras plataformas. No entanto, é possível fazer isso graças a um \emph{script} criado por \citeonline{DiPalma2017}. Ele permite exportar os dados de uso de CPU em formato \emph{JSON}, o que permite extrair e comparar apenas os dados que serão usados. Sua interface é mostrada na Figura \ref{profilerdataexporter}.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.75\textwidth]{./Figuras/profiler_data_exporter.png}
	\caption[Profiler Data Exporter]{\emph{Profiler Data Exporter}.}
	\fonte{\cite{DiPalma2017}}
	\label{profilerdataexporter}
\end{figure}

Para extrair esses dados, foi usado um \emph{script} em \emph{Javascript} que os atribui para o formato certo para que possam ser convertidos em valores separados por vírgulas por meio do site \underline{\emph{http://convertcsv.com/json-to-csv.htm}} e depois lidos em um \emph{software} de planilhas que permita a leitura desse formato de valor.

\section{Cenários de comparação}

Cada cenário foi feito usando um dos quatro \emph{colliders} que foram mencionados antes (subseção \ref{enfatizaComparacoes}), cada um em \emph{Pre-Runtime} e \emph{Runtime}.

Para obter resultados mais relevantes, cada cena em \emph{Pre-Runtime} foi renderizada com um, dez, cinquenta, cem, quinhentos e mil objetos inseridos na cena antes de sua execução. Já em cenas em que os objetos seriam invocados, o \emph{script} gerava um, dez, cinquenta, cem, quinhentos e mil objetos por segundo durante a execução do programa.

\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.75\textwidth]{./Figuras/exemplo_cenario.png}
	\caption[Exemplo Cenário]{Exemplo de cenário de comparação.}
	\label{exemplo_cenario}
\end{figure}

O cenário \emph{Pre-Runtime} consiste de três elementos que são exibidos na Figura \ref{exemplo_cenario}, que é detalhada logo a seguir.
\begin{itemize}
	\item O objeto com um tipo de \emph{collider} e \emph{rigid body} atribuídos a ele, sem ser do tipo \emph{kinematic}. Esse objeto é representado pelo personagem em azul.
	
	\item Um objeto que permanece parado, com \emph{box collider} em todas as comparações, porém, não é atribuído \emph{rigid body} a ele, e sim \emph{trigger}, ou seja, objetos podem atravessá-lo, mas a detecção de colisão ainda ocorre. Este é representado pela plataforma que se encontra logo abaixo do personagem.
	
	\item A última plataforma em baixo, é um objeto estático, porém com um \emph{box collider}, ou seja, os objetos não podem atravessá-lo.
\end{itemize}

Conforme a quantidade de objetos do tipo do personagem aumentar (parâmetro de medição de número de objetos da cena), os próprios são posicionados aleatoriamente na cena, e as plataformas são alongadas para ter uma área de contato maior para os objetos dinâmicos.

O cenário \emph{Runtime} consiste dos mesmos elementos que o cenário \emph{Pre-Runtime}, porém no lugar do personagem já inserido, há um invocador que se mover na cena e invocar o objeto do personagem dentro de um período de tempo.




